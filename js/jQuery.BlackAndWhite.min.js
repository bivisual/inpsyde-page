
/**
 *
 * Version: 0.2.0
 * Author:  Gianluca Guarini
 * Contact: gianluca.guarini@gmail.com
 * Website: http://www.gianlucaguarini.com/
 * Twitter: @gianlucaguarini
 *
 * Copyright (c) 2011 Gianluca Guarini
 *
 **/
$.fn.extend({BlackAndWhite:function(c){function j(g,b,a,d){var f=b.getContext("2d"),b=0,c;f.drawImage(g,0,0,a,d);g=f.getImageData(0,0,a,d);a=g.data;d=a.length;if(k&&h)b=new Worker(h+"BnWWorker.js"),b.postMessage(g),b.onmessage=function(a){f.putImageData(a.data,0,0)};else{for(;b<d;b+=4)c=0.3*a[b]+0.59*a[b+1]+0.11*a[b+2],a[b]=a[b+1]=a[b+2]=c;f.putImageData(g,0,0)}}var e=this,c=$.extend({hoverEffect:!0,webworkerPath:!1,responsive:!0},c),i=c.hoverEffect,h=c.webworkerPath,l=c.responsive,m=!!document.createElement("canvas").getContext, n=$(window),k="undefined"!==typeof Worker?!0:!1,o=$.browser.msie&&7===+$.browser.version;this.init=function(){m&&!(jQuery.browser.msie&&"9.0"==jQuery.browser.version)?$(e).each(function(c,b){var a=$(b).find("img");$(a).prop("src");var d=$(a).width(),f=$(a).height();$('<canvas width="'+d+'" height="'+f+'"></canvas>').prependTo(b);var e=$(b).find("canvas");$(e).css({position:"absolute",top:0,left:0});j(a[0],e[0],d,f);i&&($(this).mouseenter(function(){$(this).find("canvas").stop(!0,!0).fadeOut()}),$(this).mouseleave(function(){$(this).find("canvas").stop(!0, !0).fadeIn()}))}):($(e).each(function(c,b){var a=$(b).find("img"),d=$(b).find("img").prop("src"),e=$(a).prop("width"),a=$(a).prop("height");$("<img src="+d+' width="'+e+'" height="'+a+'" class="ieFix" /> ').prependTo(b);$(".ieFix").css({position:"absolute",top:0,left:0,filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})}),i&&($(e).mouseenter(function(){$(this).children(".ieFix").stop(!0,!0).fadeOut()}),$(e).mouseleave(function(){$(this).children(".ieFix").stop(!0,!0).fadeIn()}))); if(l)n.on("resize orientationchange",e.resizeImages)};this.resizeImages=function(){$(e).each(function(c,b){var a=$(b).find("img:not(.ieFix)");if(o)var d=$(a).prop("width"),a=$(a).prop("height");else d=$(a).width(),a=$(a).height();$(this).find(".ieFix, canvas").css({width:d,height:a})})};return this.init(c)}});
